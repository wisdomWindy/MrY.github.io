var C=Object.defineProperty;var k=(a,e,t)=>e in a?C(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var c=(a,e,t)=>(k(a,typeof e!="symbol"?e+"":e,t),t),y=(a,e,t)=>{if(!e.has(a))throw TypeError("Cannot "+t)};var s=(a,e,t)=>(y(a,e,"read from private field"),t?t.call(a):e.get(a)),R=(a,e,t)=>{if(e.has(a))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(a):e.set(a,t)},L=(a,e,t,r)=>(y(a,e,"write to private field"),r?r.call(a,t):e.set(a,t),t);import{a as B,f as S,r as U,o as x,c as P,b as g,w as N,e as W,E as j,l as G,_ as M}from"./index-25d71f25.js";var n;(function(a){a.LOAD="LOAD",a.EXEC="EXEC",a.WRITE_FILE="WRITE_FILE",a.READ_FILE="READ_FILE",a.DELETE_FILE="DELETE_FILE",a.RENAME="RENAME",a.CREATE_DIR="CREATE_DIR",a.LIST_DIR="LIST_DIR",a.DELETE_DIR="DELETE_DIR",a.ERROR="ERROR",a.DOWNLOAD="DOWNLOAD",a.PROGRESS="PROGRESS",a.LOG="LOG",a.MOUNT="MOUNT",a.UNMOUNT="UNMOUNT"})(n||(n={}));const V=(()=>{let a=0;return()=>a++})(),X=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),$=new Error("called FFmpeg.terminate()");var l,u,h,p,w,D,d;class F{constructor(){R(this,l,null);R(this,u,{});R(this,h,{});R(this,p,[]);R(this,w,[]);c(this,"loaded",!1);R(this,D,()=>{s(this,l)&&(s(this,l).onmessage=({data:{id:e,type:t,data:r}})=>{switch(t){case n.LOAD:this.loaded=!0,s(this,u)[e](r);break;case n.MOUNT:case n.UNMOUNT:case n.EXEC:case n.WRITE_FILE:case n.READ_FILE:case n.DELETE_FILE:case n.RENAME:case n.CREATE_DIR:case n.LIST_DIR:case n.DELETE_DIR:s(this,u)[e](r);break;case n.LOG:s(this,p).forEach(o=>o(r));break;case n.PROGRESS:s(this,w).forEach(o=>o(r));break;case n.ERROR:s(this,h)[e](r);break}delete s(this,u)[e],delete s(this,h)[e]})});R(this,d,({type:e,data:t},r=[],o)=>s(this,l)?new Promise((i,f)=>{const E=V();s(this,l)&&s(this,l).postMessage({id:E,type:e,data:t},r),s(this,u)[E]=i,s(this,h)[E]=f,o==null||o.addEventListener("abort",()=>{f(new DOMException(`Message # ${E} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(X));c(this,"load",(e={},{signal:t}={})=>(s(this,l)||(L(this,l,new Worker(new URL("/assets/worker-1779ba70.js",self.location),{type:"module"})),s(this,D).call(this)),s(this,d).call(this,{type:n.LOAD,data:e},void 0,t)));c(this,"exec",(e,t=-1,{signal:r}={})=>s(this,d).call(this,{type:n.EXEC,data:{args:e,timeout:t}},void 0,r));c(this,"terminate",()=>{const e=Object.keys(s(this,h));for(const t of e)s(this,h)[t]($),delete s(this,h)[t],delete s(this,u)[t];s(this,l)&&(s(this,l).terminate(),L(this,l,null),this.loaded=!1)});c(this,"writeFile",(e,t,{signal:r}={})=>{const o=[];return t instanceof Uint8Array&&o.push(t.buffer),s(this,d).call(this,{type:n.WRITE_FILE,data:{path:e,data:t}},o,r)});c(this,"mount",(e,t,r)=>{const o=[];return s(this,d).call(this,{type:n.MOUNT,data:{fsType:e,options:t,mountPoint:r}},o)});c(this,"unmount",e=>{const t=[];return s(this,d).call(this,{type:n.UNMOUNT,data:{mountPoint:e}},t)});c(this,"readFile",(e,t="binary",{signal:r}={})=>s(this,d).call(this,{type:n.READ_FILE,data:{path:e,encoding:t}},void 0,r));c(this,"deleteFile",(e,{signal:t}={})=>s(this,d).call(this,{type:n.DELETE_FILE,data:{path:e}},void 0,t));c(this,"rename",(e,t,{signal:r}={})=>s(this,d).call(this,{type:n.RENAME,data:{oldPath:e,newPath:t}},void 0,r));c(this,"createDir",(e,{signal:t}={})=>s(this,d).call(this,{type:n.CREATE_DIR,data:{path:e}},void 0,t));c(this,"listDir",(e,{signal:t}={})=>s(this,d).call(this,{type:n.LIST_DIR,data:{path:e}},void 0,t));c(this,"deleteDir",(e,{signal:t}={})=>s(this,d).call(this,{type:n.DELETE_DIR,data:{path:e}},void 0,t))}on(e,t){e==="log"?s(this,p).push(t):e==="progress"&&s(this,w).push(t)}off(e,t){e==="log"?L(this,p,s(this,p).filter(r=>r!==t)):e==="progress"&&L(this,w,s(this,w).filter(r=>r!==t))}}l=new WeakMap,u=new WeakMap,h=new WeakMap,p=new WeakMap,w=new WeakMap,D=new WeakMap,d=new WeakMap;const H=new Error("failed to get response body reader"),z=new Error("failed to complete download"),Y="Content-Length",Z=a=>new Promise((e,t)=>{const r=new FileReader;r.onload=()=>{const{result:o}=r;o instanceof ArrayBuffer?e(new Uint8Array(o)):e(new Uint8Array)},r.onerror=o=>{var i,f;t(Error(`File could not be read! Code=${((f=(i=o==null?void 0:o.target)==null?void 0:i.error)==null?void 0:f.code)||-1}`))},r.readAsArrayBuffer(a)}),q=async a=>{let e;if(typeof a=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(a)?e=atob(a.split(",")[1]).split("").map(t=>t.charCodeAt(0)):e=await(await fetch(a)).arrayBuffer();else if(a instanceof URL)e=await(await fetch(a)).arrayBuffer();else if(a instanceof File||a instanceof Blob)e=await Z(a);else return new Uint8Array;return new Uint8Array(e)},J=async(a,e)=>{var o;const t=await fetch(a);let r;try{const i=parseInt(t.headers.get(Y)||"-1"),f=(o=t.body)==null?void 0:o.getReader();if(!f)throw H;const E=[];let _=0;for(;;){const{done:m,value:O}=await f.read(),I=O?O.length:0;if(m){if(i!=-1&&i!==_)throw z;e&&e({url:a,total:i,received:_,delta:I,done:m});break}E.push(O),_+=I,e&&e({url:a,total:i,received:_,delta:I,done:m})}const A=new Uint8Array(_);let b=0;for(const m of E)A.set(m,b),b+=m.length;r=A.buffer}catch(i){console.log("failed to send download progress event: ",i),r=await t.arrayBuffer(),e&&e({url:a,total:r.byteLength,received:r.byteLength,delta:0,done:!0})}return r},T=async(a,e,t=!1,r)=>{const o=t?await J(a,r):await(await fetch(a)).arrayBuffer(),i=new Blob([o],{type:e});return URL.createObjectURL(i)},K={class:"video-transform"},v="https://unpkg.com/@ffmpeg/core@0.12.2/dist/umd",Q=B({__name:"VideoTransform",setup(a){const e=S(),t=new F;async function r(o){try{await t.load({coreURL:await T(`${v}/ffmpeg-core.js`,"text/javascript"),wasmURL:await T(`${v}/ffmpeg-core.wasm`,"application/wasm")});let i=await q(o.raw),f=await t.writeFile("input.wmv",i),E=await t.exec(["-i","input.wmv","-f","mp4","output.mp4"]);const _=await t.readFile("output.mp4");e.value&&(e.value.src=URL.createObjectURL(new Blob([_],{type:"video/mp4"})))}catch(i){j.error({message:i.message})}}return(o,i)=>{const f=U("el-button"),E=U("el-upload");return x(),P("div",K,[g(E,{ref:"uploadRef",class:"upload-demo",accept:"video/*","auto-upload":!1,"on-change":r},{trigger:N(()=>[g(f,{type:"primary"},{default:N(()=>[G("select file")]),_:1})]),_:1},512),W("video",{class:"video",ref_key:"video",ref:e},null,512)])}}});const ae=M(Q,[["__scopeId","data-v-df3f2694"]]);export{ae as default};
